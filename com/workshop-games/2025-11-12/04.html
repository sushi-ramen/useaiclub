<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚ºãƒ¬ã‚’æ¢ã›ï¼</title>
    <!-- Tailwind CSS CDNã‚’èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Interãƒ•ã‚©ãƒ³ãƒˆã‚’å„ªå…ˆã—ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¨­å®š */
        body {
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #e5e7eb; /* Light gray background */
        }
        /* ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .game-grid {
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
        }
        /* ãƒœã‚¿ãƒ³ã®åŸºæœ¬çš„ãªã‚¹ã‚¿ã‚¤ãƒ«ã¨ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ */
        .game-button {
            transition: all 0.15s ease-in-out;
            box-shadow: 0 4px #4b5563; /* Shadow for button press effect */
            border-bottom: 2px solid #374151;
        }
        /* ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆæŠ¼ã—ãŸæ™‚ã®ã¸ã“ã¿ï¼‰ */
        .game-button:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px #4b5563;
        }
        /* ãƒã‚ºãƒ¬ã‚’æŠ¼ã—ãŸæ™‚ã®ç‰¹åˆ¥ãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .shake-on-fail {
            animation: shake 0.5s;
        }
        /* éè¡¨ç¤ºã«ãªã£ãŸãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .button-hidden {
            visibility: hidden; /* è¦ç´ ã®ã‚¹ãƒšãƒ¼ã‚¹ã¯æ®‹ã™ãŒéè¡¨ç¤ºã«ã™ã‚‹ */
            pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç„¡åŠ¹ã«ã™ã‚‹ */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="gameContainer" class="w-full max-w-md bg-white p-6 rounded-xl shadow-2xl space-y-6">
        
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
        <div class="text-center space-y-2">
            <h1 class="text-3xl font-extrabold text-gray-800">ãƒã‚ºãƒ¬ã‚’æ¢ã›ï¼</h1>
            <p id="scoreDisplay" class="text-2xl font-bold text-blue-600">ãƒã‚¤ãƒ³ãƒˆ: 0 / 6</p>
        </div>

        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
        <div class="min-h-[3rem] flex items-center justify-center">
            <p id="messageArea" class="text-xl font-semibold text-gray-700 transition-opacity duration-300">å¥½ããªãƒœã‚¿ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
        </div>

        <!-- 9ã¤ã®ãƒœã‚¿ãƒ³ã®ã‚°ãƒªãƒƒãƒ‰ -->
        <div id="buttonGrid" class="game-grid grid gap-4 aspect-square">
            <!-- JavaScriptã§ãƒœã‚¿ãƒ³ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
        </div>

        <!-- ãƒªã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ï¼ˆéè¡¨ç¤ºã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆï¼‰ -->
        <div class="text-center pt-4">
            <button id="restartButton" onclick="startGame()"
                    class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-lg shadow-md transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-green-300"
                    aria-label="ã‚²ãƒ¼ãƒ ã‚’ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ">
                ã‚‚ã†ä¸€åº¦éŠã¶
            </button>
        </div>

    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        const WIN_SCORE = 6;
        let score = 0;
        let bombIndex = -1;
        let isGameOver = false;
        // æ—¢ã«å½“ãŸã‚Šã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦éè¡¨ç¤ºã«ãªã£ãŸãƒœã‚¿ãƒ³ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä¿æŒã™ã‚‹é…åˆ—
        let clearedIndices = []; 

        // DOMè¦ç´ ã®å–å¾—
        const buttonGrid = document.getElementById('buttonGrid');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const messageArea = document.getElementById('messageArea');
        const restartButton = document.getElementById('restartButton');

        // Firestoreã®åˆ©ç”¨ã¯ä¸è¦ãªãŸã‚ã€APIã‚­ãƒ¼ã‚„Firebaseã®è¨­å®šã¯çœç•¥ã—ã¾ã™ã€‚

        /**
         * 0ã‹ã‚‰8ã¾ã§ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•´æ•°ã‚’ç”Ÿæˆã—ã€ãƒã‚ºãƒ¬ã®ä½ç½®ï¼ˆçˆ†å¼¾ï¼‰ã¨ã—ã¦è¨­å®šã™ã‚‹ã€‚
         * ãŸã ã—ã€æ—¢ã«ã‚¯ãƒªã‚¢ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã¯ãƒã‚ºãƒ¬ã«ã—ãªã„ã€‚
         */
        function setBomb() {
            let nextBombIndex;
            do {
                // 0ã‹ã‚‰8ã¾ã§ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•´æ•°ã‚’ç”Ÿæˆ
                nextBombIndex = Math.floor(Math.random() * 9);
            } while (clearedIndices.includes(nextBombIndex)); // ã‚¯ãƒªã‚¢æ¸ˆã¿ã®ãƒœã‚¿ãƒ³ã§ãªã‘ã‚Œã°ç¢ºå®š

            bombIndex = nextBombIndex;
            console.log(`æ¬¡ã®ãƒã‚ºãƒ¬ã¯ãƒœã‚¿ãƒ³ç•ªå· ${bombIndex} ã§ã™ã€‚`);
        }

        /**
         * ã‚¹ã‚³ã‚¢è¡¨ç¤ºã¨ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹ã€‚
         * @param {'initial'|'success'|'fail'|'clear'} status - ç¾åœ¨ã®ã‚²ãƒ¼ãƒ çŠ¶æ…‹
         */
        function updateUI(status = 'initial') {
            scoreDisplay.textContent = `ãƒã‚¤ãƒ³ãƒˆ: ${score} / ${WIN_SCORE}`;
            restartButton.classList.add('hidden');

            // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³è¦ç´ ã‚’å–å¾—
            const buttons = buttonGrid.querySelectorAll('.game-button');

            if (isGameOver) {
                // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼æ™‚ã®å‡¦ç†
                messageArea.textContent = 'ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ãƒã‚ºãƒ¬ã‚’æŠ¼ã—ã¦ã—ã¾ã„ã¾ã—ãŸ...';
                messageArea.classList.add('text-red-600', 'shake-on-fail');
                messageArea.classList.remove('text-gray-700', 'text-green-600');
                restartButton.classList.remove('hidden');

                // å…¨ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã€ãƒã‚ºãƒ¬ã‚’èµ¤ãè¡¨ç¤º
                buttons.forEach((btn, index) => {
                    btn.disabled = true;
                    // ã™ã¹ã¦ã®ç‰¹æ®Šãªè‰²ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                    btn.classList.remove('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700', 'bg-green-400', 'bg-green-300', 'text-green-800', 'text-white', 'font-bold', 'button-hidden');

                    if (clearedIndices.includes(index)) {
                        // ã‚¯ãƒªã‚¢æ¸ˆã¿ã®ãƒœã‚¿ãƒ³ã¯éè¡¨ç¤ºã‚’ç¶­æŒã—ã€ãƒ†ã‚­ã‚¹ãƒˆã¯ã€ŒOKã€
                        btn.classList.add('button-hidden');
                        btn.textContent = 'OK';
                    } else if (index === bombIndex) {
                        // ãƒã‚ºãƒ¬ã‚’èµ¤ãè¡¨ç¤º
                        btn.classList.add('bg-red-500', 'text-white', 'font-extrabold');
                        btn.textContent = 'ãƒã‚ºãƒ¬';
                    } else {
                        // æ®‹ã‚Šã®ãƒœã‚¿ãƒ³ã¯ç°è‰²ã«ã—ã¦ç„¡åŠ¹åŒ–
                        btn.classList.add('bg-gray-400', 'text-gray-600');
                        btn.textContent = 'ï¼Ÿ';
                    }
                });

            } else if (score === WIN_SCORE) {
                // ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢æ™‚ã®å‡¦ç† (ãƒã‚ºãƒ¬ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ä¿®æ­£)
                messageArea.textContent = 'ğŸ‰ ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼6ãƒã‚¤ãƒ³ãƒˆé”æˆã§ã™ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼';
                messageArea.classList.remove('text-red-600', 'text-gray-700', 'shake-on-fail');
                messageArea.classList.add('text-green-600');
                restartButton.classList.remove('hidden');

                // å…¨ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã€ãƒã‚ºãƒ¬ã‚’èµ¤ãã€ä»–ã‚’ç·‘ã«è¡¨ç¤º
                buttons.forEach((btn, index) => {
                    btn.disabled = true;
                    // ã™ã¹ã¦ã®ç‰¹æ®Šãªè‰²ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                    btn.classList.remove('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700', 'bg-green-400', 'bg-gray-400', 'text-gray-600', 'text-white');

                    if (clearedIndices.includes(index)) {
                        // ã‚¯ãƒªã‚¢æ¸ˆã¿ã®ãƒœã‚¿ãƒ³ã¯éè¡¨ç¤ºã‚’ç¶­æŒ
                        btn.classList.add('button-hidden');
                        btn.textContent = 'OK';
                    } else if (index === bombIndex) {
                        // æ®‹ã‚Šã®ãƒã‚ºãƒ¬ã‚’èµ¤ãè¡¨ç¤º
                        btn.classList.remove('button-hidden'); // å¿µã®ãŸã‚éè¡¨ç¤ºã‚’è§£é™¤
                        btn.classList.add('bg-red-500', 'text-white', 'font-extrabold');
                        btn.textContent = 'ãƒã‚ºãƒ¬';
                    } else {
                        // æ®‹ã‚Šã®ãƒœã‚¿ãƒ³ã¯ã‚¯ãƒªã‚¢è‰²ã«çµ±ä¸€ï¼ˆãŸã ã—ã‚¹ã‚³ã‚¢6ã§ã‚¯ãƒªã‚¢ãªã®ã§ã€é€šå¸¸ã“ã“ã¯ãƒã‚ºãƒ¬ã®ã¿ã®ã¯ãšï¼‰
                        btn.classList.add('bg-green-300', 'text-green-800', 'font-bold');
                        btn.textContent = 'OK';
                    }
                });

            } else {
                // ãƒ—ãƒ¬ã‚¤ä¸­ã®å‡¦ç†ï¼ˆãƒªã‚»ãƒƒãƒˆå‡¦ç†ã‚’ç¢ºå®Ÿã«å®Ÿè¡Œï¼‰
                messageArea.textContent = (status === 'initial') ? 'å¥½ããªãƒœã‚¿ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚' : 'å½“ãŸã‚Šï¼æ¬¡ã®ãƒã‚ºãƒ¬ã¯ã©ã“ã‹ãªï¼Ÿ';
                messageArea.classList.remove('text-red-600', 'text-green-600', 'shake-on-fail');
                messageArea.classList.add('text-gray-700');

                // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
                buttons.forEach((btn, index) => {
                    // ã™ã¹ã¦ã®è‰²/çŠ¶æ…‹ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã—ã€åˆæœŸçŠ¶æ…‹ã®ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                    btn.classList.remove('bg-red-500', 'bg-gray-400', 'text-white', 'font-extrabold', 'bg-green-300', 'text-green-800', 'bg-green-400', 'text-white', 'font-bold', 'button-hidden');
                    
                    if (clearedIndices.includes(index)) {
                        // ã‚¯ãƒªã‚¢æ¸ˆã¿ã®ãƒœã‚¿ãƒ³ã¯éè¡¨ç¤ºã«ã™ã‚‹
                        btn.disabled = true;
                        btn.classList.add('button-hidden');
                        btn.textContent = 'OK';
                    } else {
                        // æœªã‚¯ãƒªã‚¢ã®ãƒœã‚¿ãƒ³ã¯æœ‰åŠ¹åŒ–ã—ã€ã€Œï¼Ÿã€ã«æˆ»ã™
                        btn.disabled = false;
                        btn.classList.add('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700');
                        btn.textContent = 'ï¼Ÿ';
                    }
                });
            }
        }

        /**
         * ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
         * @param {number} index - ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ (0-8)
         */
        function handleButtonClick(index, buttonElement) {
            if (isGameOver || score === WIN_SCORE) return;

            if (index === bombIndex) {
                // ãƒã‚ºãƒ¬ï¼ˆã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼‰
                isGameOver = true;
                // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ä¸€æ™‚çš„ã«èµ¤ãã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                buttonElement.classList.remove('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700');
                buttonElement.classList.add('bg-red-500', 'text-white', 'shake-on-fail');
                buttonElement.textContent = 'BOOM';

                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œã«UIã‚’ç¢ºå®šçŠ¶æ…‹ã«æ›´æ–°
                setTimeout(() => {
                    updateUI('fail');
                }, 500);

            } else {
                // å½“ãŸã‚Šï¼ˆãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼‰
                score++;
                clearedIndices.push(index); // ã‚¯ãƒªã‚¢æ¸ˆã¿ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«è¿½åŠ 

                // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’ä¸€æ™‚çš„ã«ç·‘ã«
                buttonElement.disabled = true;
                buttonElement.classList.remove('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700');
                buttonElement.classList.add('bg-green-400', 'text-white', 'font-bold');
                buttonElement.textContent = 'OK';

                if (score === WIN_SCORE) {
                    // ã‚¯ãƒªã‚¢å‡¦ç†
                    updateUI('clear');
                } else {
                    // æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸ (0.5ç§’å¾Œã«å…¨ãƒœã‚¿ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦æ¬¡ã®ãƒã‚ºãƒ¬ã‚’è¨­å®š)
                    setTimeout(() => {
                        // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
                        buttonElement.classList.remove('bg-green-400', 'text-white', 'font-bold');
                        buttonElement.classList.add('button-hidden');

                        setBomb();
                        updateUI('success'); // updateUIãŒä»–ã®ãƒœã‚¿ãƒ³ã‚’ã€Œï¼Ÿã€ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™
                    }, 500);
                }
            }
        }

        /**
         * ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã—ã€é–‹å§‹ã™ã‚‹ã€‚ï¼ˆå®Œå…¨ãƒªã‚»ãƒƒãƒˆã«å¯¾å¿œï¼‰
         */
        function startGame() {
            score = 0;
            isGameOver = false;
            clearedIndices = []; // ã‚¯ãƒªã‚¢æ¸ˆã¿ãƒœã‚¿ãƒ³ãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
            // æ—¢å­˜ã®ãƒœã‚¿ãƒ³ã‚’å‰Šé™¤ã—ã€å†ä½œæˆã™ã‚‹ã“ã¨ã§ã€ãƒªã‚»ãƒƒãƒˆã‚’ã‚ˆã‚Šç¢ºå®Ÿã«ã™ã‚‹
            createButtons(); 
            setBomb();
            updateUI('initial');
        }

        /**
         * 9ã¤ã®ãƒœã‚¿ãƒ³ã‚’DOMã«ç”Ÿæˆã™ã‚‹ã€‚
         */
        function createButtons() {
            buttonGrid.innerHTML = ''; // ã‚°ãƒªãƒƒãƒ‰ã‚’ã‚¯ãƒªã‚¢
            for (let i = 0; i < 9; i++) {
                const button = document.createElement('button');
                button.id = `btn-${i}`;
                button.textContent = 'ï¼Ÿ';
                // åˆæœŸçŠ¶æ…‹ã®ã‚¯ãƒ©ã‚¹ã‚’è¨­å®š
                button.className = 'game-button w-full h-full text-2xl font-semibold rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-700 transition-all duration-150 transform';
                button.onclick = () => handleButtonClick(i, button);
                buttonGrid.appendChild(button);
            }
        }

        // åˆæœŸåŒ–å‡¦ç†
        window.onload = function() {
            // ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰ã®ãƒ•ã‚©ãƒ³ãƒˆã‚’ç¢ºå®Ÿã«Interã«ã™ã‚‹
            document.body.style.fontFamily = "Inter, sans-serif";
            createButtons();
            startGame();
        };
    </script>

</body>
</html>