<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å²é˜œçœŒãŒæ„›çŸ¥çœŒã‚’é£Ÿã¹ã‚‹ã‚²ãƒ¼ãƒ </title>
    <!-- Tailwind CSS CDNã‚’èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* æ—¥æœ¬èªè¡¨ç¤ºã®ãŸã‚ã«ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆã‚’å„ªå…ˆ */
        body {
            font-family: 'Inter', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Meiryo', 'Noto Sans CJK JP', sans-serif;
            background-color: #f3f4f6; /* æ·¡ã„ã‚°ãƒ¬ãƒ¼ã®èƒŒæ™¯ */
        }
        #gameCanvas {
            border: 4px solid #4b5563; /* ãƒ€ãƒ¼ã‚¯ã‚°ãƒ¬ãƒ¼ã®æ ç·š */
            background-color: #ffffff; /* ã‚­ãƒ£ãƒ³ãƒã‚¹èƒŒæ™¯ã¯ç™½ */
            touch-action: none; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¿ãƒƒãƒã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ– */
            width: 100%; /* è¦ªè¦ç´ ã«åˆã‚ã›ã¦å¹…ã‚’100%ã« */
            height: 400px; /* ã‚ã‚‹ç¨‹åº¦ã®å›ºå®šé«˜ã•ã‚’è¨­å®šï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãªã‚µã‚¤ã‚ºèª¿æ•´ã¯JSã§è¡Œã†ï¼‰ */
            max-width: 800px; /* æœ€å¤§å¹…ã‚’åˆ¶é™ */
            border-radius: 12px;
        }
    </style>
</head>
<body class="p-4 flex flex-col items-center justify-center min-h-screen">

    <div id="game-container" class="w-full max-w-xl bg-white p-6 rounded-2xl shadow-2xl space-y-4">
        <h1 class="text-3xl font-bold text-gray-800 text-center mb-4">å²é˜œçœŒãŒæ„›çŸ¥çœŒã‚’é£Ÿã¹ã‚‹ã‚²ãƒ¼ãƒ </h1>

        <!-- ã‚²ãƒ¼ãƒ æƒ…å ±ã®è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="flex justify-between text-lg font-semibold text-gray-700">
            <div>ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
        <canvas id="gameCanvas" width="800" height="400" class="mx-auto"></canvas>

        <!-- æ“ä½œèª¬æ˜ã¨ãƒœã‚¿ãƒ³ -->
        <div class="text-center space-y-3">
            <p class="text-sm text-gray-600">
                <span class="font-bold">æ“ä½œæ–¹æ³•:</span>
                <kbd class="px-2 py-1 bg-gray-200 rounded text-xs">ã‚¯ãƒªãƒƒã‚¯</kbd> / 
                <kbd class="px-2 py-1 bg-gray-200 rounded text-xs">ã‚¿ãƒƒãƒ—</kbd>
                ã§å²é˜œçœŒã‚’ãã®ä½ç½®ã¾ã§ç§»å‹•ã•ã›ã¾ã™ã€‚
            </p>
            <button id="startButton" class="w-full py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl shadow-md transition duration-150 transform hover:scale-105">
                ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ
            </button>
        </div>

        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="messageModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
            <div class="bg-white p-8 rounded-xl shadow-2xl text-center space-y-6 w-full max-w-sm transform transition-all duration-300 scale-100" id="modalContent">
                <h2 id="modalTitle" class="text-3xl font-extrabold"></h2>
                <p id="modalMessage" class="text-lg text-gray-700"></p>
                <button id="restartButton" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg transition duration-150 transform hover:scale-105">
                    ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ï¼
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // Canvasã¨Contextã®å–å¾—
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const messageModal = document.getElementById('messageModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalMessage = document.getElementById('modalMessage');
        const scoreDisplay = document.getElementById('score');

        // ã‚²ãƒ¼ãƒ å®šæ•°
        const STATE = {
            INITIAL: 'INITIAL',
            PLAYING: 'PLAYING',
            CLEARED: 'CLEARED',
            GAMEOVER: 'GAMEOVER'
        };

        let gameState = STATE.INITIAL;
        let score = 0;

        // ã‚²ãƒ¼ãƒ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        let player = {};
        let goal = {};
        let enemies = [];
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã‚’å‰Šé™¤ã—ãŸãŸã‚ã€keysã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä¸è¦

        // æ•µã®éƒ½é“åºœçœŒãƒªã‚¹ãƒˆ
        const ENEMY_PREFECTURES = [
            { name: 'æ±äº¬éƒ½', color: '#A0522D', radius: 15 },
            { name: 'å¤§é˜ªåºœ', color: '#B8860B', radius: 14 },
            { name: 'åŒ—æµ·é“', color: '#5F9EA0', radius: 16 },
            { name: 'ç¦å²¡çœŒ', color: '#6B8E23', radius: 13 },
            { name: 'ç¦äº•çœŒ', color: '#D2B48C', radius: 12 },
            { name: 'çŸ³å·çœŒ', color: '#DC143C', radius: 13 },
            { name: 'å¯Œå±±çœŒ', color: '#00CED1', radius: 14 },
            { name: 'é•·é‡çœŒ', color: '#2E8B57', radius: 15 },
            { name: 'ä¸‰é‡çœŒ', color: '#4682B4', radius: 12 },
            { name: 'æ»‹è³€çœŒ', color: '#F4A460', radius: 16 },
            { name: 'ç¥å¥ˆå·çœŒ', color: '#708090', radius: 15 },
            { name: 'æ²–ç¸„çœŒ', color: '#BA55D3', radius: 14 },
        ];

        // --- åˆæœŸè¨­å®šã¨ãƒªã‚µã‚¤ã‚ºå‡¦ç† ---

        function resizeCanvas() {
            // è¦ªè¦ç´ ã®å¹…ã«åˆã‚ã›ã¦Canvasã®å¹…ã‚’è¨­å®š
            const container = document.getElementById('game-container');
            // æœ€å¤§å¹…ã‚’800ã«åˆ¶é™ã—ã¤ã¤ã€ã‚³ãƒ³ãƒ†ãƒŠå¹…ã®90%ã‚’ä½¿ç”¨
            const newWidth = Math.min(container.clientWidth * 0.95, 800);
            canvas.width = newWidth;
            canvas.height = Math.max(newWidth / 2, 300); // ç¸¦æ¨ªæ¯”ã‚’è€ƒæ…®ã—ã¤ã¤æœ€ä½300pxã‚’ç¢ºä¿

            // ã‚²ãƒ¼ãƒ å†è¨­å®šï¼ˆãƒªã‚µã‚¤ã‚ºå¾Œã®é…ç½®èª¿æ•´ï¼‰
            if (gameState !== STATE.INITIAL) {
                setupGameElements();
            } else {
                // åˆæœŸç”»é¢ã®æç”»
                drawInitialScreen();
            }
        }

        window.addEventListener('resize', resizeCanvas);

        // --- ã‚²ãƒ¼ãƒ è¦ç´ ã®åˆæœŸåŒ– ---

        function setupGameElements() {
            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆå²é˜œçœŒï¼‰ã®åˆæœŸåŒ–
            player = {
                x: 50,
                y: canvas.height / 2,
                radius: 20,
                color: '#4CAF50', // ç·‘è‰²
                speed: 4,
                name: 'å²é˜œçœŒ',
                vx: 0,
                vy: 0
            };

            // ã‚´ãƒ¼ãƒ«ï¼ˆæ„›çŸ¥çœŒï¼‰ã®åˆæœŸåŒ–
            goal = {
                x: canvas.width - 50,
                y: canvas.height / 2,
                radius: 25,
                color: '#FF4500', // èµ¤è‰²
                name: 'æ„›çŸ¥çœŒ'
            };

            // æ•µï¼ˆä»–ã®éƒ½é“åºœçœŒï¼‰ã®åˆæœŸåŒ–
            enemies = [];
            ENEMY_PREFECTURES.forEach((pref) => {
                let enemy = {
                    ...pref,
                    x: Math.random() * (canvas.width * 0.7) + canvas.width * 0.1,
                    y: Math.random() * (canvas.height * 0.8) + canvas.height * 0.1,
                    vx: (Math.random() - 0.5) * 0.5, // éå¸¸ã«ã‚†ã£ãã‚Šã¨ã—ãŸãƒ©ãƒ³ãƒ€ãƒ ãªæ¨ªæ–¹å‘ã®å‹•ã
                    vy: (Math.random() - 0.5) * 0.5, // éå¸¸ã«ã‚†ã£ãã‚Šã¨ã—ãŸãƒ©ãƒ³ãƒ€ãƒ ãªç¸¦æ–¹å‘ã®å‹•ã
                };
                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚„ã‚´ãƒ¼ãƒ«ã‹ã‚‰é ã„ä½ç½®ã«å†é…ç½® (ç°¡å˜ãªãƒã‚§ãƒƒã‚¯)
                while (Math.abs(enemy.x - player.x) < 150 || Math.abs(enemy.x - goal.x) < 150) {
                     enemy.x = Math.random() * (canvas.width * 0.7) + canvas.width * 0.1;
                }
                enemies.push(enemy);
            });
        }

        // --- æç”»é–¢æ•° ---

        function drawObject(obj, isPlayer = false) {
            ctx.beginPath();
            ctx.arc(obj.x, obj.y, obj.radius, 0, Math.PI * 2);
            ctx.fillStyle = obj.color;
            ctx.fill();
            ctx.strokeStyle = isPlayer ? '#222' : '#333';
            ctx.lineWidth = 2;
            ctx.stroke();

            // åå‰è¡¨ç¤º
            ctx.fillStyle = '#1f2937';
            ctx.font = `${Math.floor(obj.radius / 2.5)}px sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(obj.name, obj.x, obj.y + obj.radius + 10);
        }

        function draw() {
            // ç”»é¢ã‚¯ãƒªã‚¢
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // æ•µã®æç”»
            enemies.forEach(enemy => drawObject(enemy));

            // ã‚´ãƒ¼ãƒ«ï¼ˆæ„›çŸ¥çœŒï¼‰ã®æç”»
            drawObject(goal);

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆå²é˜œçœŒï¼‰ã®æç”»
            drawObject(player, true);

            scoreDisplay.textContent = score;
        }

        function drawInitialScreen() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#fff';
            ctx.font = '30px sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('ã€Œå²é˜œçœŒãŒæ„›çŸ¥çœŒã‚’é£Ÿã¹ã‚‹ã‚²ãƒ¼ãƒ ã€', canvas.width / 2, canvas.height / 2 - 20);
            ctx.font = '18px sans-serif';
            ctx.fillText('ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦é–‹å§‹', canvas.width / 2, canvas.height / 2 + 20);
        }

        // --- æ›´æ–°é–¢æ•° ---

        function update() {
            if (gameState !== STATE.PLAYING) return;

            // 1. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç§»å‹•
            // ãƒã‚¦ã‚¹/ã‚¿ãƒƒãƒæ“ä½œã«ã‚ˆã‚‹ç§»å‹•ã‚’åæ˜ ï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ™ãƒ¼ã‚¹ã®ç§»å‹•ï¼‰
            if (player.tx && player.ty) {
                // ã‚¿ãƒƒãƒãƒ™ã‚¯ãƒˆãƒ«ã«åŸºã¥ã„ã¦ç§»å‹•
                const dx = player.tx - player.x;
                const dy = player.ty - player.y;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist > player.speed / 2) { // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«è¿‘ã™ããªã„å ´åˆã®ã¿ç§»å‹•
                    player.vx = (dx / dist) * player.speed;
                    player.vy = (dy / dist) * player.speed;
                } else {
                    // ç›®çš„åœ°ã«åˆ°é”ã¾ãŸã¯éå¸¸ã«è¿‘ã„
                    player.x = player.tx; // ç›®çš„åœ°ã«æ­£ç¢ºã«åˆã‚ã›ã‚‹
                    player.y = player.ty;
                    player.vx = 0;
                    player.vy = 0;
                    delete player.tx; // ç›®çš„åœ°ã«åˆ°é”
                    delete player.ty;
                }
            } else {
                // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒãªã„å ´åˆã¯åœæ­¢
                player.vx = 0; player.vy = 0;
            }


            player.x += player.vx;
            player.y += player.vy;

            // ç”»é¢å¢ƒç•Œã§ã®è¡çª
            if (player.x < player.radius) player.x = player.radius;
            if (player.x > canvas.width - player.radius) player.x = canvas.width - player.radius;
            if (player.y < player.radius) player.y = player.radius;
            if (player.y > canvas.height - player.radius) player.y = canvas.height - player.radius;

            // 2. æ•µã®ç§»å‹•
            enemies.forEach(enemy => {
                enemy.x += enemy.vx;
                enemy.y += enemy.vy;

                // ç”»é¢å¢ƒç•Œã§ã®åå°„ï¼ˆå˜ç´”åŒ–ã®ãŸã‚ï¼‰
                if (enemy.x < enemy.radius || enemy.x > canvas.width - enemy.radius) {
                    enemy.vx *= -1;
                    enemy.x += enemy.vx; // ç”»é¢å¤–ã«å‡ºã‚‹ã®ã‚’é˜²ã
                }
                if (enemy.y < enemy.radius || enemy.y > canvas.height - enemy.radius) {
                    enemy.vy *= -1;
                    enemy.y += enemy.vy; // ç”»é¢å¤–ã«å‡ºã‚‹ã®ã‚’é˜²ã
                }
            });

            // 3. è¡çªåˆ¤å®š
            checkCollision();
        }

        // --- è¡çªåˆ¤å®šé–¢æ•° ---

        function checkCollision() {
            // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ï¼š2ç‚¹é–“ã®è·é›¢ã®2ä¹—
            const distSq = (obj1, obj2) => (obj1.x - obj2.x) ** 2 + (obj1.y - obj2.y) ** 2;

            // å²é˜œçœŒï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰ vs æ„›çŸ¥çœŒï¼ˆã‚´ãƒ¼ãƒ«ï¼‰
            const goalDistSq = distSq(player, goal);
            if (goalDistSq < (player.radius + goal.radius) ** 2) {
                gameState = STATE.CLEARED;
                endGame(true);
                return;
            }

            // å²é˜œçœŒï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰ vs æ•µã®éƒ½é“åºœçœŒ
            for (const enemy of enemies) {
                const enemyDistSq = distSq(player, enemy);
                if (enemyDistSq < (player.radius + enemy.radius) ** 2) {
                    gameState = STATE.GAMEOVER;
                    endGame(false);
                    return;
                }
            }
        }

        // --- ã‚²ãƒ¼ãƒ ç®¡ç†é–¢æ•° ---

        function gameLoop() {
            if (gameState === STATE.PLAYING) {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            }
        }

        function startGame() {
            if (gameState === STATE.PLAYING) return;

            // åˆæœŸåŒ–
            score = 0;
            scoreDisplay.textContent = score;
            setupGameElements();
            messageModal.classList.add('hidden');
            messageModal.classList.remove('flex');
            gameState = STATE.PLAYING;
            startButton.textContent = 'ãƒ—ãƒ¬ã‚¤ä¸­...';
            startButton.disabled = true;

            gameLoop();
        }

        function endGame(isCleared) {
            startButton.textContent = 'ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ';
            startButton.disabled = false;

            if (isCleared) {
                modalTitle.textContent = 'âœ¨å¤§å‹åˆ©ï¼æ„›çŸ¥çœŒã‚’ã‚²ãƒƒãƒˆï¼âœ¨';
                modalTitle.className = 'text-3xl font-extrabold text-green-600';
                modalMessage.textContent = 'å²é˜œçœŒãŒç›®æ¨™ã‚’é”æˆã—ã¾ã—ãŸã€‚ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼';
                document.getElementById('modalContent').classList.remove('border-red-500');
                document.getElementById('modalContent').classList.add('border-green-500');
                restartButton.classList.remove('bg-red-600');
                restartButton.classList.add('bg-green-600');

            } else {
                modalTitle.textContent = 'ğŸ’¥ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ğŸ’¥';
                modalTitle.className = 'text-3xl font-extrabold text-red-600';
                modalMessage.textContent = 'æ•µã®éƒ½é“åºœçœŒã«è§¦ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã—ã¾ã™ã‹ï¼Ÿ';
                document.getElementById('modalContent').classList.remove('border-green-500');
                document.getElementById('modalContent').classList.add('border-red-500');
                restartButton.classList.remove('bg-green-600');
                restartButton.classList.add('bg-red-600');
            }

            messageModal.classList.remove('hidden');
            messageModal.classList.add('flex');
        }

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---

        // 1. ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œãƒªã‚¹ãƒŠãƒ¼ã¯å‰Šé™¤ã—ã¾ã—ãŸã€‚

        // 2. ãƒœã‚¿ãƒ³æ“ä½œ
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);

        // 3. ã‚¿ãƒƒãƒæ“ä½œ (ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ)
        let isTouching = false;

        // å…±é€šã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¨­å®šãƒ­ã‚¸ãƒƒã‚¯
        function setPlayerTarget(clientX, clientY) {
            const rect = canvas.getBoundingClientRect();
            const targetX = clientX - rect.left;
            const targetY = clientY - rect.top;

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ç›®æ¨™ä½ç½®ã‚’è¨­å®š
            player.tx = targetX;
            player.ty = targetY;
        }

        // ã‚¿ãƒƒãƒé–‹å§‹
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
            if (gameState !== STATE.PLAYING) return;
            isTouching = true;
            setPlayerTarget(e.touches[0].clientX, e.touches[0].clientY);
        }, { passive: false });

        // ã‚¿ãƒƒãƒç§»å‹•
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault(); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
            if (gameState !== STATE.PLAYING || !isTouching) return;
            setPlayerTarget(e.touches[0].clientX, e.touches[0].clientY);
        }, { passive: false });

        // ã‚¿ãƒƒãƒçµ‚äº†
        canvas.addEventListener('touchend', () => {
            if (gameState !== STATE.PLAYING) return;
            isTouching = false;
            // touchendã§ã¯ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’æ¶ˆã•ãšã€æœ€å¾Œã®ä½ç½®ã§åœæ­¢ã•ã›ã‚‹ã“ã¨ã§ã‚¿ãƒƒãƒ—æ™‚ã®ç§»å‹•ã‚’å®Ÿç¾
        });

        // 4. ãƒã‚¦ã‚¹æ“ä½œ (ã‚¯ãƒªãƒƒã‚¯)
        window.onload = function() {
            resizeCanvas();
            drawInitialScreen();
            
            // Canvasã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
            canvas.addEventListener('click', (e) => {
                if (gameState !== STATE.PLAYING) return;
                setPlayerTarget(e.clientX, e.clientY);
            });
        };

    </script>
</body>
</html>